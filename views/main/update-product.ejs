<!DOCTYPE html>
<html lang="en">
   <head>
      <title></title>
      <link
         rel="stylesheet"
         href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
      />
      <link
         rel="stylesheet"
         href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
         integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
         crossorigin="anonymous"
      />
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      
      <script src="https://kit.fontawesome.com/a076d05399.js"></script>
      <script
         src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
         integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
         crossorigin="anonymous"
      ></script>
      <script
         src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
         integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
         crossorigin="anonymous"
      ></script>
   </head>

   <body>
      <form method="POST" id="update_product">
          <div class="container">
         <div class="row">
            <div class="col-lg-6 col-md-offset-3">
               <h1>Update your Product!</h1>
                  <div class="panel panel-default">
                     <div class="panel-body">
                        <div class="form-group">
                           <label for="kategori"
                              >Category Name:
                           </label>
                           <input
                              type="hidden"
                              name ="id"
                              id="product_id"
                              value="<%= product._id %> "
                           />
                           <input
                              type="text"
                              id="kategori"
                              class="form-control"
                              name="kategori"
                              value="<%= product.kategori %> "
                           />
                        </div>
                        <div class="form-group">
                           <label for="name">Product Name: </label>
                           <input
                              type="text"
                              id="name"
                              class="form-control"
                              name="name"
                              value = '<%= product.name %> '
                           />
                        </div>
                        <div class="form-group">
                           <label for="price">Product Price: </label>
                           <input
                              type="text"
                              id="price"
                              class="form-control"
                              name="price"
                              value = '<%= product.price %> '
                           />
                        </div>
                        <button
                           type="submit"
                           class="btn btn-success"
                        >
                           Update!
                        </button>
                        </form>

                        <!-- update script -->
                        <script >

               

                           $('#update_product').submit(function (event) {
                              event.preventDefault();

                              var unindexed_array = $(this).serializeArray();
                              var data = {};

                              $.map(unindexed_array, function (n, i) {
                                 data[n['name']] = n['value'];
                              });

                              console.log(data);

                              var request = {
                                 'url': `http://localhost:3000/api/product/${data.id}`,
                                 'method': 'PUT',
                                 'data': data,
                              };

                              $.ajax(request).done(function (response) {
                                 console.log('success');
                                 alert('Data berhasil di update');
                                 setTimeout(function() {
                                    window.location.href = "/";
                                 }, 1000);
                              });
                        });

                        </script>
                        
                     </div>
                  </div>
               </form>
            </div>
         </div>
      </div>
   </body>
</html>
